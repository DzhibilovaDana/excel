@echo off
REM ============================================================================
REM ==                                                                        ==
REM ==    Запускающий скрипт для приложения "Анализатор Отзывов" v1.2          ==
REM ==    - Добавлена смена кодировки на UTF-8 для корректной работы в Windows. ==
REM ==                                                                        ==
REM ============================================================================

TITLE Анализатор Отзывов - Запуск

REM --- Шаг 0: Установка кодировки UTF-8 для корректного отображения кириллицы ---
chcp 65001 > nul

REM --- Шаг 1: Определение рабочей директории ---
cd /d "%~dp0"
echo Текущая рабочая директория: %cd%
echo.

REM --- Шаг 2: Проверка и создание виртуального окружения ---
IF NOT EXIST ".\venv\" (
    echo Виртуальное окружение не найдено. Создание...
    
    python --version >nul 2>nul
    IF %ERRORLEVEL% NEQ 0 (
        echo.
        echo ОШИБКА: Python не найден в системных путях (PATH).
        echo Пожалуйста, установите Python (версии 3.8+) с сайта python.org
        echo и убедитесь, что при установке была отмечена галочка "Add Python to PATH".
        echo.
        pause
        exit /b 1
    )
    
    python -m venv venv
    IF %ERRORLEVEL% NEQ 0 (
        echo.
        echo ОШИБКА: Не удалось создать виртуальное окружение.
        echo Проверьте права доступа к папке и корректность установки Python.
        echo.
        pause
        exit /b 1
    )
    echo Виртуальное окружение успешно создано.
    echo.
)

REM --- Шаг 3: Активация окружения и установка зависимостей ---
echo Активация виртуального окружения...
call ".\venv\Scripts\activate.bat"

echo.
echo Установка/проверка необходимых библиотек из requirements.txt...
pip install -r requirements.txt --quiet
IF %ERRORLEVEL% NEQ 0 (
    echo.
    echo ОШИБКА: Не удалось установить зависимости.
    echo Проверьте подключение к интернету и содержимое файла requirements.txt.
    echo.
    pause
    exit /b 1
)
echo Все библиотеки готовы к работе.
echo.

REM --- Шаг 4: Запуск основного приложения ---
echo ============================================================================
echo Запуск приложения "СИБУР | Анализатор Отзывов"...
echo ============================================================================
echo.
python main.py

REM --- Шаг 5: Завершение работы ---
REM Эта пауза позволит увидеть любые ошибки Python, если они возникнут при запуске.
echo.
echo ============================================================================
echo Приложение было закрыто.
echo Если окно закрылось мгновенно и вы видите это сообщение,
echo значит в Python-коде произошла ошибка. Текст ошибки должен быть виден выше.
echo ============================================================================
pause