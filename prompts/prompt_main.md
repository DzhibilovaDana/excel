ЗАДАЧА (кратко)
На основе предоставённого массива исходных объектов (с данными из Excel по одной строке на объект) нужно сгенерировать два артефакта:

1) **artifact1_rows** — детализация шага L4 для каждой исходной строки (строго по row_index = номер строки Excel).  
2) **artifact2_by_l2** — агрегированные Функциональные Требования (ФТ) по L2 (дедупликованные по L2 внутри батча).

ВХОДНЫЕ ПОЛЯ (каждый объект входного массива имеет эти поля):
- row_index — номер строки Excel (целое). **Не изменяй.**
- l2_name, L1, L2, L3, L4, L5
- Mirapolis_L4 — значение из колонки «Mirapolis L4 (Да/Нет)»
- Ответ_Клиента
- Комментарии_уточнения
- Комментарии_со_встреч
- Проблема_текущего_состояния
- Предложение_по_решению
- Функциональные_требования

ОБЩИЕ ПРАВИЛА
- Верни **только валидный JSON** (корневой объект). Никакого текста, markdown, пояснений вокруг JSON. Язык — русский.
- Если хочешь вернуть готовый xlsx, верни поле `filled_xlsx_base64` (base64-encoded xlsx). Можно одновременно вернуть `artifact1_rows` и `artifact2_by_l2`.
- Для `artifact1_rows` **обязательно** используйте `row_index` как есть — это номер строки Excel. Если в данных есть пустые колонки — добавить разумный вывод на основе доступных комментариев/функциональных требований.
- Для полей, где требуется разделение логики по типу заявки (Офис / Массовые / Первичные), чётко указывай отдельные блоки или пометки.

Требования к **artifact1_rows** (по каждому элементу входа):
- Выдать объект с полями:
  - `row_index` (int) — из входа,
  - `process_l4_name` (string) — текст из L4,
  - `trigger` (string) — инициирующее событие (что запускает шаг — результат предыдущего шага, внешнее событие или триггер),
  - `executor` (string) — роль, выполняющая действие (указать роль явно; если неочевидно — использовать «Нанимающий менеджер / Рекрутер / HR BP»),
  - `source` (string) — откуда взята роль/решение (например: «Ответ Клиента», «Комментарии со встреч», «Предложение по решению»),
  - `step_description` (string) — связное описание шага: объединить L4 и L5, включить нюансы из Комментариев/Проблем/Предложений; описать различия для **Офиса / Массовых / Первичных** (если есть),
  - `mirapolis_action` (string) — конкретные действия в Mirapolis: если `Mirapolis_L4` = "Да" — указывать стандартный коробочный механизм (форма, статус, маршруты); если "Нет" — предлагать конфигурацию/доработку (формы, поля, статусы, интеграции и т. п.). Обязательно отметить: разные формы/маршруты/статусы для Массовых и Офиса, и условие применения упрощённого маршрута для Массовых.
  - `applicability` (array<string>) — список категорий, для которых актуален шаг: любая комбинация `["Офис"]`, `["Массовые"]`, `["Первичные"]`.
  - `issues_addressed` (array<string>) — краткие пункты проблем, которые данный шаг решает (из `Проблема_текущего_состояния`).

Пример одного элемента `artifact1_rows`:
{
  "row_index": 2,
  "process_l4_name": "Выявление потребности в найме",
  "trigger": "Запрос от НМ / увольнение в подразделении",
  "executor": "HR BP",
  "source": "Комментарии со встреч / Ответ Клиента",
  "step_description": "L4 Выявление потребности: включает L5: анализ ШР, прогноз ухода, согласование с НМ. Для Массовых — автоматизированный сбор через шаблон; для Офиса — ручная инициатива нанимающего менеджера.",
  "mirapolis_action": "Mirapolis: стандартная форма заявки 'Найм'. Если Mirapolis L4 = Да — использовать стандартную форму и маршрут: НМ -> HR BP -> Кадры. Если 'Нет' — предложить доработку: форма с обязательными полями (должность, причина, ФОТ), автоматический расчёт маршрута и интеграция с 1С.",
  "applicability": ["Офис", "Массовые"],
  "issues_addressed": ["нет централизованного реестра потребностей", "риск несвоевременного согласования"]
}

Требования к **artifact2_by_l2** (агрегация требований по L2):
- Для каждой уникальной `l2_name` внутри батча вернуть объект:
  - `l2_name` (string)
  - `requirements` (object) с ключами:
    - `data_master` : array<string> — какие справочники/мастер-данные требуются (должности, подразделения, ШР, компетенции и т.д.)
    - `ui_forms` : array<string> — какие формы, поля, обязательности, валидации; указывать отдельно для Массовых/Офиса, если отличается
    - `business_logic` : array<string> — автоматические проверки, расчёты, ветвления, условия для упрощённой маршрутизации
    - `approval_routing` : array<string> — роли согласующих, упрощённые ветви для Массовых, правила при возврате/исправлении
    - `integrations` : array<string> — с какими системами и какие данные обмениваться (1С ЗУП, R-CONF, почта), направление и частота
    - `reporting_analytics` : array<string> — необходимые отчёты/дашборды (план-факт для Массовых, SLA согласования и т.д.)
    - `security_access` : array<string> — разграничение прав для просмотра/редактирования (особенно конфиденциальные поля)

Правила агрегации:
- Дедуплицировать требования внутри батча (для одного l2_name не повторять идентичные строки).
- Если логика/форма/маршрут различается для Массовых и Офиса — указывать отдельным пунктом внутри соответствующего массива (например: "ui_forms": ["Офис: форма X с полями A,B; Массовые: массовая форма Y без поля B"]).

ПРИМЕР `artifact2_by_l2` (фрагмент):
{
  "l2_name": "Подбор персонала",
  "requirements": {
    "data_master": ["Справочник должностей", "Справочник подразделений", "Штатное расписание"],
    "ui_forms": ["Офис: форма 'Найм' с полями X,Y,Z; Массовые: упрощённая массовая форма с полем 'количество'"],
    "business_logic": ["Автоматический расчёт маршрута по подразделению", "Проверка совпадения с ШР"],
    "approval_routing": ["НМ -> HR BP -> Кадровик; Массовые: НМ -> HR (упрощённый)"],
    "integrations": ["1С ЗУП: передача позиции и ФОТ (в сторону 1С)", "R-CONF: получение структуры подразделения"],
    "reporting_analytics": ["Отчёт план/факт по массовым наймам", "SLA согласования вакансий"],
    "security_access": ["Просмотр зарплат — только HR, скрытые поля — только админы"]
  }
}

ДОПОЛНИТЕЛЬНЫЕ ИНСТРУКЦИИ:
- Если `Mirapolis_L4` = "Да", в `mirapolis_action` указывать конкретный коробочный механизм (название формы/статуса/маршрута), если он очевиден. Если не очевиден — писать "стандартный механизм — требуется сверка с коробочным каталогом".
- Если `Mirapolis_L4` = "Нет", дать минимально-возможный список доработок: UI-поля, статусы, маршруты, интеграция, требования к правам.
- Использовать данные из колонок `Ответ_Клиента`, `Комментарии_уточнения`, `Комментарии_со_встреч`, `Проблема_текущего_состояния`, `Предложение_по_решению`, `Функциональные_требования` как первоисточник для наполнения `step_description`, `mirapolis_action` и `requirements`.
- Не добавлять поля вне указанной схемы без крайней необходимости. Если добавляешь дополнительное поле — обязательно кратко назвать его семантику в самом JSON (внутри значения, например как объект с ключом `meta_explanation`), но старайся избегать.
- В `artifact1_rows` все текстовые поля должны быть ёмкими (1–6 предложений), с чёткой практической инструкцией для автоматизации.

ВЫХОД:
Корневой JSON объект, содержащий минимум:
- `artifact1_rows`: [ ... ],
- `artifact2_by_l2`: [ ... ],
— и/или опционально `filled_xlsx_base64` если возвращается готовый файл.

Спасибо — верни строго JSON в соответствии с описанной схемой.
